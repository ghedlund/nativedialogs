#
CC=clang++
LD=clang++

CFLAGS=-g -c -mmacosx-version-min=10.6 -fmessage-length=0 -D_JNI_IMPLEMENTATION_ -Wall -ansi \
	-fPIC -I/System/Library/Frameworks/JavaVM.framework/Headers -I../../../target/generated-sources/cpp/include \
	-F/System/Library/Frameworks/JavaVM.framework/Frameworks -I/System/Library/Frameworks/JavaVM.framework/Frameworks/JavaNativeFoundation.framework/Headers
	
OBJC_CFLAGS=-I/System/Library/Frameworks/Foundation.framework/Headers \
	-I/System/Library/Frameworks/Cocoa.framework/Headers

BINDIR=../../../target/cpp/objects

LIB_SOURCES=$(wildcard *.cpp)
LIB_OBJECTS=$(patsubst %.cpp, $(BINDIR)/%.o, $(LIB_SOURCES))

OBJC_SOURCES=$(wildcard mac/*.mm)
OBJC_OBJECTS=$(patsubst mac/%.mm, $(BINDIR)/%.o, $(OBJC_SOURCES))

LDFLAGS=-shared -lobjc -framework JavaVM -framework Foundation -framework Cocoa \
	-F/System/Library/Frameworks/JavaVM.framework/Frameworks -framework JavaNativeFoundation \
	-mmacosx-version-min=10.6

LIBPREFIX=lib
LIBSUFFIX=
LIBEXTENSION=jnilib
LIBSHORTNAME=nativedialogs
LIBNAME=$(BINDIR)/$(LIBPREFIX)$(LIBSHORTNAME)$(LIBSUFFIX).$(LIBEXTENSION)

INSTALL_PATH=../../../target/classes/META-INF/lib/macos

# targets
all:	$(BINDIR) $(LIB_SOURCES) $(OBJC_SOURCES) $(LIBNAME)	

$(LIBNAME):	$(LIB_OBJECTS) $(OBJC_OBJECTS)
	$(LD) $(LDFLAGS) $(LIB_OBJECTS) $(OBJC_OBJECTS) -o $@
	
$(BINDIR):
	mkdir -p $(BINDIR)
	
$(BINDIR)/%.o: %.cpp
	$(CC) $(CFLAGS) $< -o $@
	
$(BINDIR)/%.o: mac/%.mm
	$(CC) $(CFLAGS) $(OBJC_CFLAGS) $< -o $@

clean:
	rm -rf $(BINDIR)
	rm -f $(LIBNAME)

install:
	mkdir -p $(INSTALL_PATH)
	cp -f $(LIBNAME) $(INSTALL_PATH)
